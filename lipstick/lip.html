<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JSON Builder with Import/Export/Delete</title>
<style>
body{font-family:sans-serif;background:#121212;color:white;margin:0;padding:15px;display:flex;flex-direction:column;align-items:center;min-height:100vh}
input{width:100%;max-width:600px;padding:10px;margin:6px 0;border-radius:4px;border:1px solid grey;background:#1e1e1e;color:white}
button{padding:10px 15px;margin:5px;border:none;border-radius:4px;background:#333;color:white;cursor:pointer}
button:hover{background:#555}
textarea{width:100%;max-width:600px;height:300px;background:#1e1e1e;color:white;border:1px solid grey;padding:10px;border-radius:5px;margin-top:10px;resize:none}
h1{margin-bottom:10px;text-align:center;width:100%}
</style>
</head>
<body>

<h1>JSON Builder</h1>

<input type="text" id="semInput" placeholder="Enter Semester (e.g., sem3)">
<input type="text" id="subInput" placeholder="Enter Subject (e.g., c)">
<input type="text" id="progInput" placeholder="Enter Program Name (e.g., p1)">
<input type="text" id="urlInput" placeholder="Enter URL or value">

<div>
<button id="addBtn">Add Entry</button>
<button id="deleteBtn">Delete Entry</button>
<button id="downloadBtn">Download JSON</button>
</div>

<label for="fileInput">Import JSON file:</label>
<input type="file" id="fileInput" accept=".json">

<label for="urlImport">Import JSON from URL:</label>
<input type="text" id="urlImport" value="https://microintel.github.io/top/lipstick/lipstick.json" placeholder="Enter JSON file URL">
<button id="fetchUrlBtn">Fetch URL</button>

<textarea id="jsonText">{}</textarea>

<script>
let jsonData={};

const semInput=document.getElementById("semInput");
const subInput=document.getElementById("subInput");
const progInput=document.getElementById("progInput");
const urlInput=document.getElementById("urlInput");
const addBtn=document.getElementById("addBtn");
const deleteBtn=document.getElementById("deleteBtn");
const downloadBtn=document.getElementById("downloadBtn");
const fileInput=document.getElementById("fileInput");
const urlImport=document.getElementById("urlImport");
const fetchUrlBtn=document.getElementById("fetchUrlBtn");
const jsonText=document.getElementById("jsonText");

function updateTextArea(){ jsonText.value=JSON.stringify(jsonData,null,2); }

addBtn.addEventListener("click",function(){
  const sem=semInput.value.trim();
  const sub=subInput.value.trim();
  const prog=progInput.value.trim();
  const url=urlInput.value.trim();
  if(!sem||!sub||!prog||!url){alert("All fields are required");return;}
  if(!jsonData[sem]) jsonData[sem]={};
  if(!jsonData[sem][sub]) jsonData[sem][sub]={};
  jsonData[sem][sub][prog]=url;
  updateTextArea();
  semInput.value=""; subInput.value=""; progInput.value=""; urlInput.value="";
});

deleteBtn.addEventListener("click",function(){
  const sem=semInput.value.trim();
  const sub=subInput.value.trim();
  const prog=progInput.value.trim();
  if(!sem||!sub||!prog){alert("Enter sem, subject, and program to delete");return;}
  if(jsonData[sem] && jsonData[sem][sub] && jsonData[sem][sub][prog]){
    delete jsonData[sem][sub][prog];
    if(Object.keys(jsonData[sem][sub]).length===0) delete jsonData[sem][sub];
    if(Object.keys(jsonData[sem]).length===0) delete jsonData[sem];
    updateTextArea();
    semInput.value=""; subInput.value=""; progInput.value=""; urlInput.value="";
  }else{
    alert("Entry not found");
  }
});

downloadBtn.addEventListener("click",function(){
  const blob=new Blob([JSON.stringify(jsonData,null,2)],{type:"application/json"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;
  a.download="data.json";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
});

fileInput.addEventListener("change",function(e){
  const file=e.target.files[0];
  if(!file)return;
  const reader=new FileReader();
  reader.onload=function(e){
    try{
      const data=JSON.parse(e.target.result);
      jsonData=data;
      updateTextArea();
    }catch{
      alert("Invalid JSON file");
    }
  }
  reader.readAsText(file);
});

fetchUrlBtn.addEventListener("click",async function(){
  const url=urlImport.value.trim();
  if(!url){alert("Enter URL"); return;}
  try{
    const res=await fetch(url);
    const data=await res.json();
    jsonData=data;
    updateTextArea();
   // urlImport.value="";
  }catch{
    alert("Failed to fetch or invalid JSON");
  }
});
</script>

</body>
</html>