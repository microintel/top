<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lipstick</title>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- PrismJS (Dark Theme + Line Numbers) -->
<link href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-tomorrow.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-clike.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-c.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-cpp.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-python.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-javascript.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script>

<style>
    * { box-sizing: border-box; font-family: 'Poppins', sans-serif; }
    body {
        margin: 0;
        background: black;
        height: 100vh;
        display: flex;
        width: 98%;
        flex-direction: column;
        align-items: center;
        padding: 6px;
    }
    .app-name {
        position: absolute;
        top: 6px;
        left: 10px;
        font-size: 0.95rem;
        color: white;
        opacity: 0.9;
        font-weight: 500;
    }
    .top-bar {
        background: black;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items:center;
        gap: 4px;
        padding: 6px;
        border-radius: 10px;
        width: 100%;
        margin-top: 20px;
    }
    select {
        flex: 1;
        width:fit-content;
        font-size: 0.75rem;
        padding: 4px;
        border-radius: 6px;
        border: 1px solid #ccc;
    }
    .result-box {
        margin-top: 10px;
        background: black;
        width: 96%;
        color:white;
        max-width: 98%;
        flex: 2;
        border-radius: 10px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        padding: 12px;
        font-size: 0.85rem;
        overflow-y: auto;
        scrollbar-width: none;
        position: relative;
    }
    pre {
        position: relative;
        background: transparent;
        margin-top: 25px;
    }
    pre, code {
        background: #000 !important;
        color: #fff !important;
        border-radius: 0px;
        padding: 0px;
    }
    .copy-btn, .ai-btn {
        position: absolute;
        top: 8px;
        background: aqua;
        color: black;
        border: none;
        padding: 5px 10px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.7rem;
    }
    .copy-btn { right: 10px; }
    .ai-btn { right: 70px; background: white; }
    .copy-btn:hover { background: #009e86; }
    .ai-btn:hover { background: #d6b600; }
    footer {
        margin-top: 8px;
        text-align: center;
        font-size: 0.7rem;
        color: white;
        opacity: 0.9;
    }
    footer a {
        color: white;
        text-decoration: underline;
        cursor: pointer;
    }
</style>
</head>
<body>

<div class="app-name">Lipstick</div>

<div class="top-bar">
    <select id="semSelect"><option value="">Sem</option></select>
    <select id="subSelect"><option value="">Sub</option></select>
    <select id="fileSelect"><option value="">File</option></select>
</div>

<div class="result-box" id="result">
    <em>NkN...</em>
</div>

<footer>
     Developed by AI with Microintel<br>
    <a onclick="showTerms()">Terms & Conditions</a>
</footer>

<script>
const dataURL = "https://microintel.github.io/top/lipstick/lipstick.json";
let jsonData = {};

async function loadData() {
    try {
        const res = await fetch(dataURL);
        jsonData = await res.json();
        const semSelect = document.getElementById("semSelect");
        Object.keys(jsonData).forEach(sem => {
            const opt = document.createElement("option");
            opt.value = sem;
            opt.textContent = sem;
            semSelect.appendChild(opt);
        });
    } catch (err) {
        Swal.fire({ icon: "error", title: "Error loading JSON", text: err.message });
    }
}

document.getElementById("semSelect").addEventListener("change", () => {
    const sem = document.getElementById("semSelect").value;
    const subSelect = document.getElementById("subSelect");
    const fileSelect = document.getElementById("fileSelect");
    subSelect.innerHTML = '<option value="">Sub</option>';
    fileSelect.innerHTML = '<option value="">File</option>';
    if (!sem) return;

    Object.keys(jsonData[sem]).forEach(sub => {
        const opt = document.createElement("option");
        opt.value = sub;
        opt.textContent = sub;
        subSelect.appendChild(opt);
    });
});

document.getElementById("subSelect").addEventListener("change", () => {
    const sem = document.getElementById("semSelect").value;
    const sub = document.getElementById("subSelect").value;
    const fileSelect = document.getElementById("fileSelect");
    fileSelect.innerHTML = '<option value="">File</option>';
    if (!sub) return;

    Object.keys(jsonData[sem][sub]).forEach(file => {
        const opt = document.createElement("option");
        opt.value = file;
        opt.textContent = file;
        fileSelect.appendChild(opt);
    });
});

document.getElementById("fileSelect").addEventListener("change", showData);

async function showData() {
    const sem = document.getElementById("semSelect").value;
    const sub = document.getElementById("subSelect").value;
    const file = document.getElementById("fileSelect").value;
    if (!sem || !sub || !file) return;

    const url = jsonData[sem][sub][file];
    try {
        const res = await fetch(url);
        const codeText = await res.text();

        const resultBox = document.getElementById("result");
        resultBox.innerHTML = `
            <button class="ai-btn" onclick="sendToAI()">GPT</button>
            <button class="copy-btn" onclick="copyCode()">Copy</button>
            <h4>${file}</h4>

            <!-- LINE NUMBERS ENABLED -->
            <pre class="line-numbers"><code class="language-c" id="codeArea">${escapeHTML(codeText)}</code></pre>
        `;

        Prism.highlightAll();
    } catch (err) {
        Swal.fire({ icon: "error", title: "Error loading file", text: err.message });
    }
}

function copyCode() {
    const code = document.getElementById("codeArea").innerText;
    navigator.clipboard.writeText(code);
    Swal.fire({ icon: "success", title: "Copied!", timer: 1000, showConfirmButton: false });
}

function sendToAI() {
    const code = encodeURIComponent(document.getElementById("codeArea").innerText);

    Swal.fire({
        title: "Send to chatGPT",
        text: "",
        showCancelButton: true,
        confirmButtonText: "Send",
        
    }).then(res => {
        if (res.isConfirmed) {
            window.open(`https://chat.openai.com/?q=${code}`, "_blank");
        } else if (res.dismiss === Swal.DismissReason.cancel) {
           // window.open(`https://gemini.google.com/app?q=${code}`, "_blank");
        }
    });
}

function escapeHTML(str) {
    return str.replace(/[&<>"']/g, function (m) {
        return ({
            '&': '&',
            '<': '<',
            '>': '>',
            '"': '"',
            "'": '&#039;'
        })[m];
    });
}

function showTerms() {
    Swal.fire({
        title: "Lipstick â€“ Terms & Conditions",
        html: `
        <p style="text-align:left; font-size:0.85rem;">
        Lipstick is a web app for us to access lab programs in a structured way, allowing us to easily view, copy, and run programs on our system without using WhatsApp or searching files, making learning faster and more organized.<br><br>
        <s>Just like how one gets lipstick and applies it to their lips, this app helps you apply knowledge easily and beautifully</s>.<br><br>
        It is not developed for any forgery or copying lab exams, but purely for learning and understanding purposes.<br><br>
        <b>Developed by Microintel</b>
        </p>`,
        confirmButtonText: "Close",
        confirmButtonColor: "#00c9a7"
    });
}

loadData();
</script>
</body>
       </html>
